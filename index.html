<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestionCompta CI - Système de Comptabilité Gaming Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset et Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* En-tête */
        header {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .logo i {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 800;
        }

        .logo h1 span {
            color: #FFD700;
        }

        .logo small {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .header-info {
            text-align: right;
        }

        .solde h3 {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .solde h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFD700;
        }

        .date p {
            margin-top: 5px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Cartes de Statistiques */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card i {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            color: white;
        }

        .revenue i { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); }
        .expenses i { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .transactions i { background: linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%); }
        .profit i { background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%); }

        .card h4 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .card h3 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Graphiques */
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            padding: 30px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #1a2980;
        }

        .chart-container h3 i {
            color: #667eea;
        }

        /* Formulaire */
        .transaction-form {
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .transaction-form h2 {
            color: #1a2980;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 15px;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Liste des Transactions */
        .transaction-list {
            padding: 30px;
        }

        .transaction-list h2 {
            color: #1a2980;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .list-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .list-controls input,
        .list-controls select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            flex: 1;
            min-width: 200px;
        }

        .btn-export,
        .btn-backup {
            background: #28a745;
            color: white;
        }

        .btn-export:hover,
        .btn-backup:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .summary {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 1.1rem;
        }

        /* Rapports */
        .reports {
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .reports h2 {
            color: #1a2980;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-report {
            background: #17a2b8;
            color: white;
        }

        .btn-report:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .btn-print {
            background: #6c757d;
            color: white;
        }

        .btn-print:hover {
            background: #5a6268;
        }

        /* Footer */
        footer {
            background: #1a2980;
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        footer p {
            margin: 10px 0;
        }

        .help {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .backup-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .backup-option {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .backup-option h3 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #1a2980;
        }

        .btn-backup-action,
        .btn-print-action {
            margin-top: 15px;
            background: #28a745;
            color: white;
            width: 100%;
        }

        .btn-restore {
            display: inline-block;
            background: #17a2b8;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        .backup-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }

        /* Style pour les badges */
        .type-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .type-badge.income {
            background: rgba(0, 176, 155, 0.1);
            color: #00b09b;
            border: 1px solid #00b09b;
        }
        
        .type-badge.expense {
            background: rgba(255, 65, 108, 0.1);
            color: #ff416c;
            border: 1px solid #ff416c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }
            
            header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .header-info {
                text-align: center;
            }
            
            .charts {
                grid-template-columns: 1fr;
            }
            
            .summary {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-actions,
            .report-actions {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-tête -->
        <header>
            <div class="logo">
                <i class="fas fa-gamepad"></i>
                <h1>GestionCompta<span>CI</span></h1>
                <small>Système de comptabilité pour Gaming Center</small>
            </div>
            <div class="header-info">
                <div class="solde">
                    <h3>Solde Actuel</h3>
                    <h2 id="current-balance">0 FCFA</h2>
                </div>
                <div class="date">
                    <p id="current-date"></p>
                    <p>Abidjan, Côte d'Ivoire</p>
                </div>
            </div>
        </header>

        <!-- Tableau de Bord -->
        <section class="dashboard">
            <div class="stats-cards">
                <div class="card revenue">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>
                        <h4>Revenus du Mois</h4>
                        <h3 id="month-revenue">0 FCFA</h3>
                    </div>
                </div>
                <div class="card expenses">
                    <i class="fas fa-shopping-cart"></i>
                    <div>
                        <h4>Dépenses du Mois</h4>
                        <h3 id="month-expenses">0 FCFA</h3>
                    </div>
                </div>
                <div class="card transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <div>
                        <h4>Transactions</h4>
                        <h3 id="transaction-count">0</h3>
                    </div>
                </div>
                <div class="card profit">
                    <i class="fas fa-chart-line"></i>
                    <div>
                        <h4>Bénéfice Net</h4>
                        <h3 id="net-profit">0 FCFA</h3>
                    </div>
                </div>
            </div>

            <!-- Graphiques -->
            <div class="charts">
                <div class="chart-container">
                    <h3><i class="fas fa-chart-line"></i> Évolution des Revenus</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3><i class="fas fa-chart-pie"></i> Répartition des Dépenses</h3>
                    <canvas id="expensesChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Saisie de Transaction -->
        <section class="transaction-form">
            <h2><i class="fas fa-plus-circle"></i> Nouvelle Transaction</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="type">Type de Transaction *</label>
                    <select id="type" required>
                        <option value="">-- Sélectionner --</option>
                        <option value="vente">Vente (Revenu)</option>
                        <option value="abonnement">Abonnement</option>
                        <option value="recharge">Recharge Mobile</option>
                        <option value="achat_stock">Achat Stock</option>
                        <option value="loyer">Loyer & Charges</option>
                        <option value="salaire">Salaires</option>
                        <option value="electricite">Électricité/Internet</option>
                        <option value="autres">Autres Dépenses</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="description">Description *</label>
                    <input type="text" id="description" placeholder="Ex: Vente PS5 + FIFA 24" required>
                </div>
                
                <div class="form-group">
                    <label for="amount">Montant (FCFA) *</label>
                    <input type="number" id="amount" placeholder="Ex: 450000" required>
                </div>
                
                <div class="form-group">
                    <label for="payment">Mode de Paiement</label>
                    <select id="payment">
                        <option value="cash">Espèces</option>
                        <option value="mobile">Mobile Money</option>
                        <option value="carte">Carte Bancaire</option>
                        <option value="credit">Crédit Client</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" value="">
                </div>
                
                <div class="form-group">
                    <label for="category">Catégorie</label>
                    <input type="text" id="category" placeholder="Ex: Console, Snack, Réparation">
                </div>
            </div>
            
            <div class="form-actions">
                <button onclick="addTransaction()" class="btn-primary">
                    <i class="fas fa-save"></i> Enregistrer la Transaction
                </button>
                <button onclick="clearForm()" class="btn-secondary">
                    <i class="fas fa-times"></i> Effacer
                </button>
            </div>
        </section>

        <!-- Journal des Transactions -->
        <section class="transaction-list">
            <h2><i class="fas fa-history"></i> Journal des Transactions</h2>
            <div class="list-controls">
                <input type="text" id="search" placeholder="Rechercher une transaction..." onkeyup="filterTransactions()">
                <select id="filter-type" onchange="filterTransactions()">
                    <option value="">Tous les types</option>
                    <option value="vente">Ventes</option>
                    <option value="abonnement">Abonnements</option>
                    <option value="recharge">Recharges</option>
                    <option value="achat_stock">Achats</option>
                    <option value="depense">Dépenses</option>
                </select>
                <button onclick="exportToCSV()" class="btn-export">
                    <i class="fas fa-download"></i> Exporter CSV
                </button>
                <button onclick="showBackupModal()" class="btn-backup">
                    <i class="fas fa-database"></i> Sauvegarde
                </button>
            </div>
            
            <div class="table-container">
                <table id="transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Type</th>
                            <th>Montant (FCFA)</th>
                            <th>Mode Paiement</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-body">
                        <!-- Les transactions seront chargées ici -->
                    </tbody>
                </table>
            </div>
            
            <div class="summary">
                <p><strong>Total Revenus:</strong> <span id="total-revenue">0</span> FCFA</p>
                <p><strong>Total Dépenses:</strong> <span id="total-expenses">0</span> FCFA</p>
                <p><strong>Balance Totale:</strong> <span id="total-balance">0</span> FCFA</p>
            </div>
        </section>

        <!-- Section Rapports -->
        <section class="reports">
            <h2><i class="fas fa-chart-bar"></i> Rapports Rapides</h2>
            <div class="report-actions">
                <button onclick="generateDailyReport()" class="btn-report">
                    <i class="fas fa-calendar-day"></i> Rapport Journalier
                </button>
                <button onclick="generateMonthlyReport()" class="btn-report">
                    <i class="fas fa-calendar-alt"></i> Rapport Mensuel
                </button>
                <button onclick="showYearlyOverview()" class="btn-report">
                    <i class="fas fa-chart-bar"></i> Vue Annuelle
                </button>
                <button onclick="printReport()" class="btn-print">
                    <i class="fas fa-print"></i> Imprimer
                </button>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>© 2024 GestionComptaCI - Spécialement conçu pour les Gaming Centers en Côte d'Ivoire</p>
            <p class="help">
                <i class="fas fa-info-circle"></i> 
                Support: Sauvegardez régulièrement vos données via le bouton "Sauvegarde"
            </p>
        </footer>
    </div>

    <!-- Modal pour Sauvegarde -->
    <div id="backupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBackupModal()">&times;</span>
            <h2><i class="fas fa-database"></i> Sauvegarde des Données</h2>
            <p>Pour éviter de perdre vos données, effectuez régulièrement une sauvegarde.</p>
            
            <div class="backup-options">
                <div class="backup-option">
                    <h3><i class="fas fa-download"></i> Sauvegarder</h3>
                    <p>Téléchargez toutes vos données sur votre ordinateur</p>
                    <button onclick="backupData()" class="btn-backup-action">
                        <i class="fas fa-file-export"></i> Exporter les Données
                    </button>
                </div>
                
                <div class="backup-option">
                    <h3><i class="fas fa-upload"></i> Restaurer</h3>
                    <p>Chargez une sauvegarde précédente</p>
                    <input type="file" id="restoreFile" accept=".json,.txt" onchange="restoreData(event)">
                    <label for="restoreFile" class="btn-restore">
                        <i class="fas fa-file-import"></i> Choisir un Fichier
                    </label>
                </div>
                
                <div class="backup-option">
                    <h3><i class="fas fa-print"></i> Impression</h3>
                    <p>Imprimez votre journal de transactions</p>
                    <button onclick="printTransactions()" class="btn-print-action">
                        <i class="fas fa-print"></i> Imprimer le Journal
                    </button>
                </div>
            </div>
            
            <div class="backup-info">
                <p><i class="fas fa-lightbulb"></i> <strong>Conseil:</strong> Sauvegardez vos données sur une clé USB chaque semaine!</p>
            </div>
        </div>
    </div>

    <script>
        // Données initiales
        let transactions = [];
        let charts = {};

        // Configuration initiale
        document.addEventListener('DOMContentLoaded', function() {
            // Définir la date d'aujourd'hui par défaut
            document.getElementById('date').valueAsDate = new Date();
            
            // Mettre à jour la date actuelle
            updateCurrentDate();
            
            // Charger les données sauvegardées
            loadSavedData();
            
            // Initialiser les graphiques
            initializeCharts();
            
            // Afficher les transactions
            renderTransactions();
            
            // Calculer et afficher les statistiques
            updateStats();
            
            // Ajouter des données d'exemple si vide
            if (transactions.length === 0) {
                addSampleData();
            }
        });

        // Mettre à jour la date actuelle
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('current-date').textContent = 
                now.toLocaleDateString('fr-CI', options);
        }

        // Initialiser les graphiques
        function initializeCharts() {
            const ctx1 = document.getElementById('revenueChart').getContext('2d');
            const ctx2 = document.getElementById('expensesChart').getContext('2d');
            
            // Graphique des revenus
            charts.revenue = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'],
                    datasets: [{
                        label: 'Revenus (FCFA)',
                        data: new Array(12).fill(0),
                        borderColor: '#00b09b',
                        backgroundColor: 'rgba(0, 176, 155, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
            
            // Graphique des dépenses
            charts.expenses = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Achats Stock', 'Loyer', 'Salaires', 'Électricité', 'Autres'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Ajouter une transaction
        function addTransaction() {
            const type = document.getElementById('type').value;
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const payment = document.getElementById('payment').value;
            const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
            const category = document.getElementById('category').value;
            
            // Validation
            if (!type || !description || isNaN(amount) || amount <= 0) {
                alert('Veuillez remplir tous les champs obligatoires avec des valeurs valides!');
                return;
            }
            
            // Créer la transaction
            const transaction = {
                id: Date.now(),
                type: type,
                description: description,
                amount: amount,
                payment: payment,
                date: date,
                category: category || getDefaultCategory(type),
                timestamp: new Date().toISOString()
            };
            
            // Ajouter à la liste
            transactions.unshift(transaction);
            
            // Sauvegarder
            saveData();
            
            // Mettre à jour l'affichage
            renderTransactions();
            updateStats();
            updateCharts();
            
            // Réinitialiser le formulaire
            clearForm();
            
            // Message de confirmation
            alert(`Transaction enregistrée: ${description} - ${amount.toLocaleString('fr-CI')} FCFA`);
        }

        // Obtenir la catégorie par défaut
        function getDefaultCategory(type) {
            const categories = {
                'vente': 'Vente',
                'abonnement': 'Abonnement',
                'recharge': 'Recharge Mobile',
                'achat_stock': 'Achat Stock',
                'loyer': 'Loyer & Charges',
                'salaire': 'Personnel',
                'electricite': 'Services',
                'autres': 'Divers'
            };
            return categories[type] || 'Divers';
        }

        // Effacer le formulaire
        function clearForm() {
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('category').value = '';
            document.getElementById('date').valueAsDate = new Date();
        }

        // Afficher les transactions
        function renderTransactions() {
            const tbody = document.getElementById('transactions-body');
            tbody.innerHTML = '';
            
            if (transactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                            <p>Aucune transaction enregistrée</p>
                            <p style="font-size: 0.9rem; color: #666;">Commencez par ajouter votre première transaction ci-dessus</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Trier par date (plus récent d'abord)
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            transactions.forEach(transaction => {
                const isIncome = ['vente', 'abonnement', 'recharge'].includes(transaction.type);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description}</td>
                    <td><span class="type-badge ${isIncome ? 'income' : 'expense'}">${getTypeLabel(transaction.type)}</span></td>
                    <td style="font-weight: bold; color: ${isIncome ? '#00b09b' : '#ff416c'}">
                        ${isIncome ? '+' : '-'} ${transaction.amount.toLocaleString('fr-CI')} FCFA
                    </td>
                    <td>${getPaymentLabel(transaction.payment)}</td>
                    <td>
                        <button onclick="deleteTransaction(${transaction.id})" class="btn-delete">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Formater la date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-CI', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Obtenir le label du type
        function getTypeLabel(type) {
            const labels = {
                'vente': 'Vente',
                'abonnement': 'Abonnement',
                'recharge': 'Recharge',
                'achat_stock': 'Achat Stock',
                'loyer': 'Loyer',
                'salaire': 'Salaire',
                'electricite': 'Électricité',
                'autres': 'Autre'
            };
            return labels[type] || type;
        }

        // Obtenir le label du paiement
        function getPaymentLabel(payment) {
            const labels = {
                'cash': 'Espèces',
                'mobile': 'Mobile Money',
                'carte': 'Carte',
                'credit': 'Crédit'
            };
            return labels[payment] || payment;
        }

        // Supprimer une transaction
        function deleteTransaction(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette transaction ?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                renderTransactions();
                updateStats();
                updateCharts();
            }
        }

        // Mettre à jour les statistiques
        function updateStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            let monthRevenue = 0;
            let monthExpenses = 0;
            let totalRevenue = 0;
            let totalExpenses = 0;
            
            transactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                const isIncome = ['vente', 'abonnement', 'recharge'].includes(transaction.type);
                
                if (isIncome) {
                    totalRevenue += transaction.amount;
                    if (transactionDate.getMonth() === currentMonth && 
                        transactionDate.getFullYear() === currentYear) {
                        monthRevenue += transaction.amount;
                    }
                } else {
                    totalExpenses += transaction.amount;
                    if (transactionDate.getMonth() === currentMonth && 
                        transactionDate.getFullYear() === currentYear) {
                        monthExpenses += transaction.amount;
                    }
                }
            });
            
            const totalBalance = totalRevenue - totalExpenses;
            const monthProfit = monthRevenue - monthExpenses;
            
            // Mettre à jour l'affichage
            document.getElementById('current-balance').textContent = 
                `${totalBalance.toLocaleString('fr-CI')} FCFA`;
            
            document.getElementById('month-revenue').textContent = 
                `${monthRevenue.toLocaleString('fr-CI')} FCFA`;
            
            document.getElementById('month-expenses').textContent = 
                `${monthExpenses.toLocaleString('fr-CI')} FCFA`;
            
            document.getElementById('transaction-count').textContent = 
                transactions.length;
            
            document.getElementById('net-profit').textContent = 
                `${monthProfit.toLocaleString('fr-CI')} FCFA`;
            
            document.getElementById('total-revenue').textContent = 
                totalRevenue.toLocaleString('fr-CI');
            
            document.getElementById('total-expenses').textContent = 
                totalExpenses.toLocaleString('fr-CI');
            
            document.getElementById('total-balance').textContent = 
                totalBalance.toLocaleString('fr-CI');
        }

        // Mettre à jour les graphiques
        function updateCharts() {
            // Préparer les données par mois
            const monthlyData = new Array(12).fill(0);
            const expenseData = {
                'Achats Stock': 0,
                'Loyer': 0,
                'Salaires': 0,
                'Électricité': 0,
                'Autres': 0
            };
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const month = date.getMonth();
                const isIncome = ['vente', 'abonnement', 'recharge'].includes(transaction.type);
                
                if (isIncome) {
                    monthlyData[month] += transaction.amount;
                } else {
                    // Catégoriser les dépenses
                    const category = transaction.category || 'Autres';
                    if (expenseData.hasOwnProperty(category)) {
                        expenseData[category] += transaction.amount;
                    } else {
                        expenseData['Autres'] += transaction.amount;
                    }
                }
            });
            
            // Mettre à jour le graphique des revenus
            charts.revenue.data.datasets[0].data = monthlyData;
            charts.revenue.update();
            
            // Mettre à jour le graphique des dépenses
            charts.expenses.data.datasets[0].data = [
                expenseData['Achats Stock'],
                expenseData['Loyer'],
                expenseData['Salaires'],
                expenseData['Électricité'],
                expenseData['Autres']
            ];
            charts.expenses.update();
        }

        // Filtrer les transactions
        function filterTransactions() {
            const search = document.getElementById('search').value.toLowerCase();
            const filterType = document.getElementById('filter-type').value;
            
            const filtered = transactions.filter(transaction => {
                const matchesSearch = transaction.description.toLowerCase().includes(search) ||
                                     transaction.category.toLowerCase().includes(search);
                
                const matchesType = !filterType || 
                                   (filterType === 'depense' ? 
                                    !['vente', 'abonnement', 'recharge'].includes(transaction.type) :
                                    transaction.type === filterType);
                
                return matchesSearch && matchesType;
            });
            
            // Afficher les transactions filtrées
            const tbody = document.getElementById('transactions-body');
            tbody.innerHTML = '';
            
            filtered.forEach(transaction => {
                const isIncome = ['vente', 'abonnement', 'recharge'].includes(transaction.type);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description}</td>
                    <td><span class="type-badge ${isIncome ? 'income' : 'expense'}">${getTypeLabel(transaction.type)}</span></td>
                    <td style="font-weight: bold; color: ${isIncome ? '#00b09b' : '#ff416c'}">
                        ${isIncome ? '+' : '-'} ${transaction.amount.toLocaleString('fr-CI')} FCFA
                    </td>
                    <td>${getPaymentLabel(transaction.payment)}</td>
                    <td>
                        <button onclick="deleteTransaction(${transaction.id})" class="btn-delete">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Exporter en CSV
        function exportToCSV() {
            if (transactions.length === 0) {
                alert('Aucune donnée à exporter!');
                return;
            }
            
            const headers = ['Date', 'Description', 'Type', 'Montant (FCFA)', 'Mode Paiement', 'Catégorie'];
            const csv = [
                headers.join(','),
                ...transactions.map(t => [
                    formatDate(t.date),
                    `"${t.description}"`,
                    getTypeLabel(t.type),
                    t.amount,
                    getPaymentLabel(t.payment),
                    t.category
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `compta_gaming_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Fichier CSV exporté avec ${transactions.length} transactions!`);
        }

        // Générer un rapport journalier
        function generateDailyReport() {
            const today = new Date().toISOString().split('T')[0];
            const todayTransactions = transactions.filter(t => t.date === today);
            
            if (todayTransactions.length === 0) {
                alert('Aucune transaction aujourd\'hui!');
                return;
            }
            
            const revenue = todayTransactions
                .filter(t => ['vente', 'abonnement', 'recharge'].includes(t.type))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = todayTransactions
                .filter(t => !['vente', 'abonnement', 'recharge'].includes(t.type))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const report = `
=== RAPPORT JOURNALIER ===
Date: ${formatDate(today)}
Total Transactions: ${todayTransactions.length}
Revenus: ${revenue.toLocaleString('fr-CI')} FCFA
Dépenses: ${expenses.toLocaleString('fr-CI')} FCFA
Bénéfice: ${(revenue - expenses).toLocaleString('fr-CI')} FCFA

Transactions:
${todayTransactions.map(t => 
    `- ${t.description}: ${['vente', 'abonnement', 'recharge'].includes(t.type) ? '+' : '-'}${t.amount.toLocaleString('fr-CI')} FCFA`
).join('\n')}
            `;
            
            alert(report);
        }

        // Générer un rapport mensuel
        function generateMonthlyReport() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthTransactions = transactions.filter(t => {
                const date = new Date(t.date);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear;
            });
            
            if (monthTransactions.length === 0) {
                alert('Aucune transaction ce mois-ci!');
                return;
            }
            
            const revenue = monthTransactions
                .filter(t => ['vente', 'abonnement', 'recharge'].includes(t.type))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = monthTransactions
                .filter(t => !['vente', 'abonnement', 'recharge'].includes(t.type))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthNames = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                               'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
            
            const report = `
=== RAPPORT MENSUEL ===
Mois: ${monthNames[currentMonth]} ${currentYear}
Total Transactions: ${monthTransactions.length}
Total Revenus: ${revenue.toLocaleString('fr-CI')} FCFA
Total Dépenses: ${expenses.toLocaleString('fr-CI')} FCFA
Bénéfice Net: ${(revenue - expenses).toLocaleString('fr-CI')} FCFA

Détail par Catégorie:
Ventes: ${monthTransactions.filter(t => t.type === 'vente').reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA
Abonnements: ${monthTransactions.filter(t => t.type === 'abonnement').reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA
Recharges: ${monthTransactions.filter(t => t.type === 'recharge').reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA
Achats: ${monthTransactions.filter(t => t.type === 'achat_stock').reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA
            `;
            
            alert(report);
        }

        // Afficher la vue annuelle
        function showYearlyOverview() {
            const yearlyData = {};
            
            transactions.forEach(t => {
                const date = new Date(t.date);
                const year = date.getFullYear();
                const month = date.getMonth();
                const isIncome = ['vente', 'abonnement', 'recharge'].includes(t.type);
                
                if (!yearlyData[year]) {
                    yearlyData[year] = new Array(12).fill(0);
                }
                
                if (isIncome) {
                    yearlyData[year][month] += t.amount;
                }
            });
            
            const currentYear = new Date().getFullYear();
            const data = yearlyData[currentYear] || new Array(12).fill(0);
            const monthNames = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 
                               'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'];
            
            let overview = `=== VUE ANNUELLE ${currentYear} ===\n`;
            
            data.forEach((amount, index) => {
                overview += `${monthNames[index]}: ${amount.toLocaleString('fr-CI')} FCFA\n`;
            });
            
            overview += `\nTotal Annuel: ${data.reduce((a, b) => a + b, 0).toLocaleString('fr-CI')} FCFA`;
            
            alert(overview);
        }

        // Sauvegarder les données
        function saveData() {
            const data = {
                transactions: transactions,
                lastSaved: new Date().toISOString()
            };
            
            localStorage.setItem('gamingComptaData', JSON.stringify(data, null, 2));
            console.log('Données sauvegardées localement');
        }

        // Charger les données sauvegardées
        function loadSavedData() {
            const saved = localStorage.getItem('gamingComptaData');
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    transactions = data.transactions || [];
                    console.log(`Données chargées: ${transactions.length} transactions`);
                } catch (e) {
                    console.error('Erreur de chargement des données:', e);
                    transactions = [];
                }
            }
        }

        // Ajouter des données d'exemple
        function addSampleData() {
            const sampleTransactions = [
                {
                    id: 1,
                    type: 'vente',
                    description: 'PS5 + FIFA 24',
                    amount: 450000,
                    payment: 'cash',
                    date: new Date().toISOString().split('T')[0],
                    category: 'Console'
                },
                {
                    id: 2,
                    type: 'abonnement',
                    description: 'Abonnement Mensuel Gold',
                    amount: 25000,
                    payment: 'mobile',
                    date: new Date().toISOString().split('T')[0],
                    category: 'Abonnement'
                },
                {
                    id: 3,
                    type: 'recharge',
                    description: 'Recharge Orange Money',
                    amount: 10000,
                    payment: 'cash',
                    date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                    category: 'Recharge'
                },
                {
                    id: 4,
                    type: 'achat_stock',
                    description: 'Achat boissons et snacks',
                    amount: 75000,
                    payment: 'cash',
                    date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                    category: 'Achats Stock'
                },
                {
                    id: 5,
                    type: 'loyer',
                    description: 'Loyer local commercial',
                    amount: 150000,
                    payment: 'carte',
                    date: new Date(Date.now() - 172800000).toISOString().split('T')[0],
                    category: 'Loyer'
                }
            ];
            
            transactions.push(...sampleTransactions);
            saveData();
            renderTransactions();
            updateStats();
            updateCharts();
        }

        // Sauvegarde des données
        function backupData() {
            const data = {
                transactions: transactions,
                metadata: {
                    exported: new Date().toISOString(),
                    totalTransactions: transactions.length,
                    totalAmount: transactions.reduce((sum, t) => sum + t.amount, 0)
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.href = url;
            link.download = `sauvegarde_compta_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Sauvegarde réussie! ${transactions.length} transactions exportées.`);
        }

        // Restaurer des données
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('Attention! Cela remplacera toutes vos données actuelles. Continuer?')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    transactions = data.transactions || [];
                    saveData();
                    renderTransactions();
                    updateStats();
                    updateCharts();
                    
                    alert(`Données restaurées avec succès! ${transactions.length} transactions chargées.`);
                } catch (error) {
                    alert('Erreur: Fichier de sauvegarde invalide!');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // Gestion du modal
        function showBackupModal() {
            document.getElementById('backupModal').style.display = 'flex';
        }

        function closeBackupModal() {
            document.getElementById('backupModal').style.display = 'none';
        }

        // Impression
        function printReport() {
            window.print();
        }

        function printTransactions() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Journal des Transactions - Gaming Center</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #1a2980; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                            th { background-color: #f8f9fa; }
                            .total { font-weight: bold; margin-top: 20px; }
                        </style>
                    </head>
                    <body>
                        <h1>Journal des Transactions</h1>
                        <p>Date d'impression: ${new Date().toLocaleDateString('fr-CI')}</p>
                        <p>Total transactions: ${transactions.length}</p>
                        <table>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Type</th>
                                <th>Montant (FCFA)</th>
                                <th>Mode Paiement</th>
                            </tr>
                            ${transactions.map(t => `
                                <tr>
                                    <td>${formatDate(t.date)}</td>
                                    <td>${t.description}</td>
                                    <td>${getTypeLabel(t.type)}</td>
                                    <td>${['vente', 'abonnement', 'recharge'].includes(t.type) ? '+' : '-'}${t.amount.toLocaleString('fr-CI')}</td>
                                    <td>${getPaymentLabel(t.payment)}</td>
                                </tr>
                            `).join('')}
                        </table>
                        <div class="total">
                            <p>Total Revenus: ${transactions.filter(t => ['vente', 'abonnement', 'recharge'].includes(t.type)).reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA</p>
                            <p>Total Dépenses: ${transactions.filter(t => !['vente', 'abonnement', 'recharge'].includes(t.type)).reduce((s, t) => s + t.amount, 0).toLocaleString('fr-CI')} FCFA</p>
                            <p>Balance Totale: ${(transactions.filter(t => ['vente', 'abonnement', 'recharge'].includes(t.type)).reduce((s, t) => s + t.amount, 0) - 
                                               transactions.filter(t => !['vente', 'abonnement', 'recharge'].includes(t.type)).reduce((s, t) => s + t.amount, 0)).toLocaleString('fr-CI')} FCFA</p>
                        </div>
                        <script>
                            window.onload = function() { window.print(); window.close(); }
                        </script>
                    </body>
                </html>
            `);
        }
    </script>
</body>
</html>
